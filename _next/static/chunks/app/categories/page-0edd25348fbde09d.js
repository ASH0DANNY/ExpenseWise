(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[379],{3936:(e,a,s)=>{Promise.resolve().then(s.bind(s,9371))},6126:(e,a,s)=>{"use strict";s.d(a,{E:()=>l});var r=s(5155);s(2115);var t=s(2085),n=s(9434);let i=(0,t.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:a,variant:s,...t}=e;return(0,r.jsx)("div",{className:(0,n.cn)(i({variant:s}),a),...t})}},8763:(e,a,s)=>{"use strict";s.d(a,{A:()=>r});let r=(0,s(157).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},9371:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>B});var r=s(5155),t=s(2115),n=s(221),i=s(2177),l=s(5594),d=s(6715),o=s(5838),c=s(5041),m=s(6104),u=s(5317),g=s(285),h=s(6695),x=s(2523),y=s(5127),j=s(7759),p=s(7481),v=s(172),f=s(8763),w=s(4301);let b=(0,s(157).A)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);var C=s(7223),N=s(6126),E=s(10),A=s(8856);let k="categories",P=l.z.object({name:l.z.string().min(1,{message:"Category name cannot be empty."})}),M=(0,u.rJ)(m.db,"categories"),S=(0,u.rJ)(m.db,"expenses");function B(){let e=(0,d.jE)(),{toast:a}=(0,p.dj)(),[s,l]=t.useState(null),{data:B=[],isLoading:_,error:q}=(0,o.I)({queryKey:[k],queryFn:async()=>{let e=(0,u.P)(M,(0,u.My)("name"));return(await (0,u.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))},staleTime:3e5}),z=(0,c.n)({mutationFn:async e=>{let a=(0,u.P)(M,(0,u._M)("name","==",e.name));if(!(await (0,u.GG)(a)).empty){let a=e.name.toLowerCase();if(B.some(e=>e.name.toLowerCase()===a))throw Error("Category name already exists.")}return{id:(await (0,u.gS)(M,e)).id,...e}},onSuccess:s=>{e.invalidateQueries({queryKey:[k]}),a({title:"Category Added",description:'Category "'.concat(s.name,'" has been added.')}),L.reset()},onError:e=>{"Category name already exists."===e.message?L.setError("name",{type:"manual",message:e.message}):a({title:"Error Adding Category",description:e.message||"Could not add the category.",variant:"destructive"})}}),G=(0,c.n)({mutationFn:async e=>{let{id:a,data:s}=e,r=s.name.toLowerCase();if(B.some(e=>e.id!==a&&e.name.toLowerCase()===r))throw Error("Category name already exists.");let t=(0,u.H9)(m.db,"categories",a);return await (0,u.mZ)(t,s),{id:a,...s}},onSuccess:s=>{e.invalidateQueries({queryKey:[k]}),a({title:"Category Updated",description:'Category "'.concat(s.name,'" has been updated.')}),l(null),L.reset()},onError:e=>{"Category name already exists."===e.message?L.setError("name",{type:"manual",message:e.message}):a({title:"Error Updating Category",description:e.message||"Could not update the category.",variant:"destructive"})}}),H=(0,c.n)({mutationFn:async e=>{let a=B.find(a=>a.id===e);if(!a)throw Error("Category not found.");let s=(0,u.P)(S,(0,u._M)("category","==",a.name),(0,u.AB)(1));if(!(await (0,u.GG)(s)).empty)throw Error('Category "'.concat(a.name,'" is currently assigned to one or more expenses.'));let r=(0,u.H9)(m.db,"categories",e);return await (0,u.kd)(r),e},onSuccess:r=>{let t=B.find(e=>e.id===r);e.setQueryData([k],e=>e?e.filter(e=>e.id!==r):[]),e.invalidateQueries({queryKey:[k]}),a({title:"Category Deleted",description:'Category "'.concat((null==t?void 0:t.name)||"",'" has been removed.'),variant:"destructive"}),s===r&&(l(null),L.reset())},onError:e=>{a({title:"Cannot Delete Category",description:e.message||"Could not delete the category.",variant:"destructive"})}}),L=(0,i.mN)({resolver:(0,n.u)(P),defaultValues:{name:""}});return(t.useEffect(()=>{if(null!==s){let e=B.find(e=>e.id===s);e&&L.reset({name:e.name})}else L.reset({name:""})},[s,B,L]),q)?(0,r.jsxs)("div",{className:"text-destructive",children:["Error loading categories: ",q.message]}):(0,r.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,r.jsx)("div",{className:"lg:col-span-1",id:"category-form-card",children:(0,r.jsxs)(h.Zp,{children:[(0,r.jsxs)(h.aR,{children:[(0,r.jsx)(h.ZB,{children:null!==s?"Edit Category":"Add New Category"}),(0,r.jsx)(h.BT,{children:null!==s?"Update the category name.":"Create a new expense category."})]}),(0,r.jsx)(j.lV,{...L,children:(0,r.jsxs)("form",{onSubmit:L.handleSubmit(function(e){null!==s?G.mutate({id:s,data:e}):z.mutate(e)}),children:[(0,r.jsx)(h.Wu,{className:"space-y-4",children:(0,r.jsx)(j.zB,{control:L.control,name:"name",render:e=>{let{field:a}=e;return(0,r.jsxs)(j.eI,{children:[(0,r.jsx)(j.lR,{children:"Category Name"}),(0,r.jsx)(j.MJ,{children:(0,r.jsx)(x.p,{placeholder:"e.g., Groceries, Utilities",...a,disabled:_||z.isPending||G.isPending})}),(0,r.jsx)(j.C5,{})]})}})}),(0,r.jsxs)(h.wL,{className:"flex justify-between flex-wrap gap-2",children:[" ",null!==s&&(0,r.jsxs)(g.$,{type:"button",variant:"outline",onClick:function(){l(null),L.reset()},disabled:_||G.isPending,className:"flex-grow sm:flex-grow-0",children:[" ","Cancel"]}),(0,r.jsxs)(g.$,{type:"submit",className:null===s?"w-full sm:w-auto flex-grow sm:flex-grow-0":"flex-grow sm:flex-grow-0",disabled:_||z.isPending||G.isPending,children:[z.isPending||G.isPending?(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4 animate-spin"}):null!==s?(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4"}):(0,r.jsx)(w.A,{className:"mr-2 h-4 w-4"}),null!==s?"Update Category":"Add Category"]})]})]})})]})}),(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsxs)(h.Zp,{children:[(0,r.jsxs)(h.aR,{children:[(0,r.jsx)(h.ZB,{children:"Category List"}),(0,r.jsx)(h.BT,{children:"Manage your expense categories."})]}),(0,r.jsx)(h.Wu,{children:(0,r.jsxs)("div",{className:"overflow-x-auto",children:[" ",_?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(A.E,{className:"h-10 w-full"}),(0,r.jsx)(A.E,{className:"h-10 w-full"}),(0,r.jsx)(A.E,{className:"h-10 w-full"}),(0,r.jsx)(A.E,{className:"h-10 w-full"}),(0,r.jsx)(A.E,{className:"h-10 w-full"})]}):(0,r.jsxs)(y.XI,{children:[(0,r.jsx)(y.A0,{children:(0,r.jsxs)(y.Hj,{children:[(0,r.jsx)(y.nd,{children:"Name"}),(0,r.jsx)(y.nd,{children:"Actions"})]})}),(0,r.jsxs)(y.BF,{children:[0===B.length&&!_&&(0,r.jsx)(y.Hj,{children:(0,r.jsx)(y.nA,{colSpan:2,className:"text-center text-muted-foreground py-4",children:"No categories added yet."})}),B.map(e=>(0,r.jsxs)(y.Hj,{className:s===e.id?"bg-secondary":"",children:[(0,r.jsx)(y.nA,{className:"font-medium whitespace-nowrap",children:(0,r.jsxs)(N.E,{variant:"secondary",children:[(0,r.jsx)(b,{className:"inline-block h-3 w-3 mr-1"}),e.name]})}),(0,r.jsxs)(y.nA,{className:"space-x-1 whitespace-nowrap",children:[(0,r.jsx)(g.$,{variant:"ghost",size:"icon",onClick:()=>(function(e){l(e);let a=document.getElementById("category-form-card");null==a||a.scrollIntoView({behavior:"smooth",block:"start"})})(e.id),"aria-label":"Edit category",disabled:s===e.id||H.isPending,children:(0,r.jsx)(f.A,{className:"h-4 w-4"})}),(0,r.jsxs)(E.Lt,{children:[(0,r.jsx)(E.tv,{asChild:!0,children:(0,r.jsx)(g.$,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive","aria-label":"Delete category",disabled:s===e.id||H.isPending&&H.variables===e.id,children:H.isPending&&H.variables===e.id?(0,r.jsx)(v.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(C.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(E.EO,{children:[(0,r.jsxs)(E.wd,{children:[(0,r.jsx)(E.r7,{children:"Are you sure?"}),(0,r.jsxs)(E.$v,{children:['This action cannot be undone. This will permanently delete the category "',e.name,'". Make sure no expenses are using this category.']})]}),(0,r.jsxs)(E.ck,{children:[(0,r.jsx)(E.Zr,{children:"Cancel"}),(0,r.jsxs)(E.Rx,{className:(0,g.r)({variant:"destructive"}),onClick:()=>{var a;return a=e.id,void H.mutate(a)},disabled:H.isPending,children:[H.isPending&&H.variables===e.id?(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})]})]})]},e.id))]})]})]})})]})})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,879,817,808,532,441,684,358],()=>a(3936)),_N_E=e.O()}]);