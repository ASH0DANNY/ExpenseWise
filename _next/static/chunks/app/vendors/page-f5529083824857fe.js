(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[830],{3261:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>M});var a=s(5155),r=s(2115),t=s(221),d=s(2177),i=s(5594),l=s(6715),o=s(5838),c=s(5041),h=s(6104),m=s(5317),x=s(285),u=s(6695),j=s(2523),p=s(5127),g=s(7759),v=s(7481),w=s(172),y=s(8763),f=s(4301);let N=(0,s(157).A)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);var P=s(7223),b=s(10),E=s(8856);let k="vendors",A=i.z.object({name:i.z.string().min(1,{message:"Vendor name cannot be empty."}),contactPerson:i.z.string().optional(),contactEmail:i.z.string().email({message:"Invalid email address."}).optional().or(i.z.literal("")),contactPhone:i.z.string().optional()}),V=(0,m.rJ)(h.db,"vendors"),C=(0,m.rJ)(h.db,"expenses");function M(){let e=(0,l.jE)(),{toast:n}=(0,v.dj)(),[s,i]=r.useState(null),{data:M=[],isLoading:z,error:B}=(0,o.I)({queryKey:[k],queryFn:async()=>{let e=(0,m.P)(V,(0,m.My)("name"));return(await (0,m.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))},staleTime:3e5}),S=(0,c.n)({mutationFn:async e=>{let n=e.name.toLowerCase();if(M.some(e=>e.name.toLowerCase()===n))throw Error("Vendor name already exists.");return{id:(await (0,m.gS)(V,e)).id,...e}},onSuccess:s=>{e.invalidateQueries({queryKey:[k]}),n({title:"Vendor Added",description:'Vendor "'.concat(s.name,'" has been added.')}),J.reset()},onError:e=>{"Vendor name already exists."===e.message?J.setError("name",{type:"manual",message:e.message}):n({title:"Error Adding Vendor",description:e.message||"Could not add the vendor.",variant:"destructive"})}}),I=(0,c.n)({mutationFn:async e=>{let{id:n,data:s}=e,a=s.name.toLowerCase();if(M.some(e=>e.id!==n&&e.name.toLowerCase()===a))throw Error("Vendor name already exists.");let r=(0,m.H9)(h.db,"vendors",n);return await (0,m.mZ)(r,s),{id:n,...s}},onSuccess:s=>{e.invalidateQueries({queryKey:[k]}),n({title:"Vendor Updated",description:'Vendor "'.concat(s.name,'" has been updated.')}),i(null),J.reset()},onError:e=>{"Vendor name already exists."===e.message?J.setError("name",{type:"manual",message:e.message}):n({title:"Error Updating Vendor",description:e.message||"Could not update the vendor.",variant:"destructive"})}}),L=(0,c.n)({mutationFn:async e=>{let n=M.find(n=>n.id===e);if(!n)throw Error("Vendor not found.");let s=(0,m.P)(C,(0,m._M)("vendor","==",n.name),(0,m.AB)(1));if(!(await (0,m.GG)(s)).empty)throw Error('Vendor "'.concat(n.name,'" is currently assigned to one or more expenses.'));let a=(0,m.H9)(h.db,"vendors",e);return await (0,m.kd)(a),e},onSuccess:a=>{let r=M.find(e=>e.id===a);e.setQueryData([k],e=>e?e.filter(e=>e.id!==a):[]),e.invalidateQueries({queryKey:[k]}),n({title:"Vendor Deleted",description:'Vendor "'.concat((null==r?void 0:r.name)||"",'" has been removed.'),variant:"destructive"}),s===a&&(i(null),J.reset())},onError:e=>{n({title:"Cannot Delete Vendor",description:e.message||"Could not delete the vendor.",variant:"destructive"})}}),J=(0,d.mN)({resolver:(0,t.u)(A),defaultValues:{name:"",contactPerson:"",contactEmail:"",contactPhone:""}});return(r.useEffect(()=>{if(null!==s){let e=M.find(e=>e.id===s);e&&J.reset({name:e.name,contactPerson:e.contactPerson||"",contactEmail:e.contactEmail||"",contactPhone:e.contactPhone||""})}else J.reset({name:"",contactPerson:"",contactEmail:"",contactPhone:""})},[s,M,J]),B)?(0,a.jsxs)("div",{className:"text-destructive",children:["Error loading vendors: ",B.message]}):(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,a.jsx)("div",{className:"lg:col-span-1",id:"vendor-form-card",children:(0,a.jsxs)(u.Zp,{children:[(0,a.jsxs)(u.aR,{children:[(0,a.jsx)(u.ZB,{children:null!==s?"Edit Vendor":"Add New Vendor"}),(0,a.jsx)(u.BT,{children:null!==s?"Update the vendor details.":"Add a new vendor or party."})]}),(0,a.jsx)(g.lV,{...J,children:(0,a.jsxs)("form",{onSubmit:J.handleSubmit(function(e){null!==s?I.mutate({id:s,data:e}):S.mutate(e)}),children:[(0,a.jsxs)(u.Wu,{className:"space-y-4",children:[(0,a.jsx)(g.zB,{control:J.control,name:"name",render:e=>{let{field:n}=e;return(0,a.jsxs)(g.eI,{children:[(0,a.jsx)(g.lR,{children:"Vendor Name"}),(0,a.jsx)(g.MJ,{children:(0,a.jsx)(j.p,{placeholder:"e.g., SuperMart, Landlord",...n,disabled:z||S.isPending||I.isPending})}),(0,a.jsx)(g.C5,{})]})}}),(0,a.jsx)(g.zB,{control:J.control,name:"contactPerson",render:e=>{let{field:n}=e;return(0,a.jsxs)(g.eI,{children:[(0,a.jsx)(g.lR,{children:"Contact Person (Optional)"}),(0,a.jsx)(g.MJ,{children:(0,a.jsx)(j.p,{placeholder:"e.g., John Doe",...n,disabled:z||S.isPending||I.isPending})}),(0,a.jsx)(g.C5,{})]})}}),(0,a.jsx)(g.zB,{control:J.control,name:"contactEmail",render:e=>{let{field:n}=e;return(0,a.jsxs)(g.eI,{children:[(0,a.jsx)(g.lR,{children:"Contact Email (Optional)"}),(0,a.jsx)(g.MJ,{children:(0,a.jsx)(j.p,{type:"email",placeholder:"e.g., contact@example.com",...n,disabled:z||S.isPending||I.isPending})}),(0,a.jsx)(g.C5,{})]})}}),(0,a.jsx)(g.zB,{control:J.control,name:"contactPhone",render:e=>{let{field:n}=e;return(0,a.jsxs)(g.eI,{children:[(0,a.jsx)(g.lR,{children:"Contact Phone (Optional)"}),(0,a.jsx)(g.MJ,{children:(0,a.jsx)(j.p,{placeholder:"e.g., 123-456-7890",...n,disabled:z||S.isPending||I.isPending})}),(0,a.jsx)(g.C5,{})]})}})]}),(0,a.jsxs)(u.wL,{className:"flex justify-between flex-wrap gap-2",children:[" ",null!==s&&(0,a.jsxs)(x.$,{type:"button",variant:"outline",onClick:function(){i(null),J.reset()},disabled:z||I.isPending,className:"flex-grow sm:flex-grow-0",children:[" ","Cancel"]}),(0,a.jsxs)(x.$,{type:"submit",className:null===s?"w-full sm:w-auto flex-grow sm:flex-grow-0":"flex-grow sm:flex-grow-0",disabled:z||S.isPending||I.isPending,children:[S.isPending||I.isPending?(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4 animate-spin"}):null!==s?(0,a.jsx)(y.A,{className:"mr-2 h-4 w-4"}):(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4"}),null!==s?"Update Vendor":"Add Vendor"]})]})]})})]})}),(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)(u.Zp,{children:[(0,a.jsxs)(u.aR,{children:[(0,a.jsx)(u.ZB,{children:"Vendor List"}),(0,a.jsx)(u.BT,{children:"Manage your vendors and parties."})]}),(0,a.jsx)(u.Wu,{children:(0,a.jsxs)("div",{className:"overflow-x-auto",children:[" ",z?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(E.E,{className:"h-10 w-full"}),(0,a.jsx)(E.E,{className:"h-10 w-full"}),(0,a.jsx)(E.E,{className:"h-10 w-full"}),(0,a.jsx)(E.E,{className:"h-10 w-full"}),(0,a.jsx)(E.E,{className:"h-10 w-full"})]}):(0,a.jsxs)(p.XI,{children:[(0,a.jsx)(p.A0,{children:(0,a.jsxs)(p.Hj,{children:[(0,a.jsx)(p.nd,{children:"Name"}),(0,a.jsx)(p.nd,{children:"Contact Person"}),(0,a.jsx)(p.nd,{children:"Email"}),(0,a.jsx)(p.nd,{children:"Phone"}),(0,a.jsx)(p.nd,{children:"Actions"})]})}),(0,a.jsxs)(p.BF,{children:[0===M.length&&!z&&(0,a.jsx)(p.Hj,{children:(0,a.jsx)(p.nA,{colSpan:5,className:"text-center text-muted-foreground py-4",children:"No vendors added yet."})}),M.map(e=>(0,a.jsxs)(p.Hj,{className:s===e.id?"bg-secondary":"",children:[(0,a.jsxs)(p.nA,{className:"font-medium whitespace-nowrap",children:[(0,a.jsx)(N,{className:"inline-block h-4 w-4 mr-1 text-muted-foreground"}),e.name]}),(0,a.jsx)(p.nA,{className:"whitespace-nowrap",children:e.contactPerson||"-"}),(0,a.jsx)(p.nA,{className:"whitespace-nowrap",children:e.contactEmail||"-"}),(0,a.jsx)(p.nA,{className:"whitespace-nowrap",children:e.contactPhone||"-"}),(0,a.jsxs)(p.nA,{className:"space-x-1 whitespace-nowrap",children:[(0,a.jsx)(x.$,{variant:"ghost",size:"icon",onClick:()=>(function(e){i(e);let n=document.getElementById("vendor-form-card");null==n||n.scrollIntoView({behavior:"smooth",block:"start"})})(e.id),"aria-label":"Edit vendor",disabled:s===e.id||L.isPending,children:(0,a.jsx)(y.A,{className:"h-4 w-4"})}),(0,a.jsxs)(b.Lt,{children:[(0,a.jsx)(b.tv,{asChild:!0,children:(0,a.jsx)(x.$,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive","aria-label":"Delete vendor",disabled:s===e.id||L.isPending&&L.variables===e.id,children:L.isPending&&L.variables===e.id?(0,a.jsx)(w.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(P.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(b.EO,{children:[(0,a.jsxs)(b.wd,{children:[(0,a.jsx)(b.r7,{children:"Are you sure?"}),(0,a.jsxs)(b.$v,{children:['This action cannot be undone. This will permanently delete the vendor "',e.name,'". Make sure no expenses are using this vendor.']})]}),(0,a.jsxs)(b.ck,{children:[(0,a.jsx)(b.Zr,{children:"Cancel"}),(0,a.jsxs)(b.Rx,{className:(0,x.r)({variant:"destructive"}),onClick:()=>{var n;return n=e.id,void L.mutate(n)},disabled:L.isPending,children:[L.isPending&&L.variables===e.id?(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})]})]})]},e.id))]})]})]})})]})})]})}},8221:(e,n,s)=>{Promise.resolve().then(s.bind(s,3261))},8763:(e,n,s)=>{"use strict";s.d(n,{A:()=>a});let a=(0,s(157).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])}},e=>{var n=n=>e(e.s=n);e.O(0,[992,879,817,808,532,441,684,358],()=>n(8221)),_N_E=e.O()}]);