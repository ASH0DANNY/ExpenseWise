(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{2639:(e,a,s)=>{Promise.resolve().then(s.bind(s,5440))},5440:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>er});var t=s(5155),r=s(2115),n=s(221),d=s(2177),i=s(5594),l=s(3013),o=s(6715),c=s(9145),u=s(5838),x=s(5041),m=s(6104),p=s(5317),h=s(285),f=s(6695),g=s(2523),v=s(5746),j=s(9556),y=s(7381),b=s(518),w=s(9434);let N=v.bL;v.YJ;let A=v.WT,P=r.forwardRef((e,a)=>{let{className:s,children:r,...n}=e;return(0,t.jsxs)(v.l9,{ref:a,className:(0,w.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[r,(0,t.jsx)(v.In,{asChild:!0,children:(0,t.jsx)(j.A,{className:"h-4 w-4 opacity-50"})})]})});P.displayName=v.l9.displayName;let _=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(v.PP,{ref:a,className:(0,w.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,t.jsx)(y.A,{className:"h-4 w-4"})})});_.displayName=v.PP.displayName;let C=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(v.wn,{ref:a,className:(0,w.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,t.jsx)(j.A,{className:"h-4 w-4"})})});C.displayName=v.wn.displayName;let E=r.forwardRef((e,a)=>{let{className:s,children:r,position:n="popper",...d}=e;return(0,t.jsx)(v.ZL,{children:(0,t.jsxs)(v.UC,{ref:a,className:(0,w.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...d,children:[(0,t.jsx)(_,{}),(0,t.jsx)(v.LM,{className:(0,w.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,t.jsx)(C,{})]})})});E.displayName=v.UC.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(v.JU,{ref:a,className:(0,w.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=v.JU.displayName;let z=r.forwardRef((e,a)=>{let{className:s,children:r,...n}=e;return(0,t.jsxs)(v.q7,{ref:a,className:(0,w.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(v.VF,{children:(0,t.jsx)(b.A,{className:"h-4 w-4"})})}),(0,t.jsx)(v.p4,{children:r})]})});z.displayName=v.q7.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(v.wv,{ref:a,className:(0,w.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=v.wv.displayName;var q=s(965),D=s(3158),R=s(3900);function L(e){let{className:a,classNames:s,showOutsideDays:r=!0,...n}=e;return(0,t.jsx)(R.hv,{showOutsideDays:r,className:(0,w.cn)("p-3",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,w.cn)((0,h.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,w.cn)((0,h.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:a,...s}=e;return(0,t.jsx)(q.A,{className:(0,w.cn)("h-4 w-4",a),...s})},IconRight:e=>{let{className:a,...s}=e;return(0,t.jsx)(D.A,{className:(0,w.cn)("h-4 w-4",a),...s})}},...n})}L.displayName="Calendar";var M=s(547);let V=M.bL,k=M.l9,B=r.forwardRef((e,a)=>{let{className:s,align:r="center",sideOffset:n=4,...d}=e;return(0,t.jsx)(M.ZL,{children:(0,t.jsx)(M.UC,{ref:a,align:r,sideOffset:n,className:(0,w.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...d})})});B.displayName=M.UC.displayName;var F=s(5127),G=s(7759);let J=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("textarea",{className:(0,w.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...r})});J.displayName="Textarea";var S=s(7481),I=s(1920),K=s(172),T=s(4301),H=s(7223),O=s(6126),Q=s(10),Z=s(8856),$=s(3096);let U="expenses",W="summaryData",X=(0,p.rJ)(m.db,"expenses"),Y=(0,p.rJ)(m.db,"categories"),ee=(0,p.rJ)(m.db,"vendors"),ea=(0,p.rJ)(m.db,"settings"),es=i.z.object({date:i.z.date({required_error:"Expense date is required."}),amount:i.z.coerce.number().positive({message:"Amount must be positive."}),category:i.z.string({required_error:"Category is required."}).min(1,"Category is required."),vendor:i.z.string().optional(),notes:i.z.string().optional()}),et=e=>e?e instanceof p.Dc?e.toDate():e:new Date;function er(){let e=(0,o.jE)(),{toast:a}=(0,S.dj)(),{ref:s,inView:i}=(0,$.Wx)(),{data:v,fetchNextPage:j,hasNextPage:y,isLoading:b,isFetchingNextPage:_,error:C}=(0,c.q)({queryKey:[U],queryFn:async e=>{let{pageParam:a=null}=e,s=a?(0,p.P)(X,(0,p.My)("date","desc"),(0,p.HM)(a),(0,p.AB)(15)):(0,p.P)(X,(0,p.My)("date","desc"),(0,p.AB)(15)),t=await (0,p.GG)(s);return{expenses:t.docs.map(e=>{let a=e.data();return{id:e.id,...a,date:et(a.date)}}),lastVisible:t.docs[t.docs.length-1]||null}},getNextPageParam:e=>e.lastVisible,initialPageParam:null,staleTime:12e4}),q=r.useMemo(()=>{var e;return null!==(e=null==v?void 0:v.pages.flatMap(e=>e.expenses))&&void 0!==e?e:[]},[v]);r.useEffect(()=>{i&&y&&!_&&j()},[i,y,j,_]);let{data:D=[],isLoading:R,error:M}=(0,u.I)({queryKey:["categories"],queryFn:async()=>{let e=(0,p.P)(Y,(0,p.My)("name"));return(await (0,p.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))},staleTime:9e5}),{data:er=[],isLoading:en,error:ed}=(0,u.I)({queryKey:["vendors"],queryFn:async()=>{let e=(0,p.P)(ee,(0,p.My)("name"));return(await (0,p.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))},staleTime:9e5}),ei=b&&!(null==v?void 0:v.pages.length),el=C||M||ed;async function eo(){let e=(0,p.H9)(ea,"globalSummary");if(!(await (0,p.x7)(e)).exists()){console.log("Summary document not found, creating with defaults.");try{await setDoc(e,{totalExpenses:0,expenseCount:0}),console.log("Summary document created successfully.")}catch(e){throw console.error("Error creating summary document:",e),Error("Failed to initialize summary data.")}}return e}let ec=(0,x.n)({mutationFn:async e=>{let a={...e,date:p.Dc.fromDate(e.date),vendor:"__none__"===e.vendor?null:e.vendor},s=await eo(),t=(0,p.wP)(m.db),r=(0,p.H9)(X);return t.set(r,a),t.update(s,{totalExpenses:(0,p.GV)(e.amount),expenseCount:(0,p.GV)(1)}),await t.commit(),{id:r.id,...e}},onSuccess:s=>{e.refetchQueries({queryKey:[U],exact:!0}),e.invalidateQueries({queryKey:[W]}),e.invalidateQueries({queryKey:[U,"recent"]}),a({title:"Expense Added",description:"Added ".concat(s.category," expense of $").concat(s.amount.toFixed(2),".")}),ex.reset({amount:void 0,category:"",vendor:"",notes:"",date:new Date})},onError:e=>{a({title:"Error Adding Expense",description:e.message||"Could not add the expense.",variant:"destructive"}),console.error("Error adding expense:",e)}}),eu=(0,x.n)({mutationFn:async e=>{let{id:a,amount:s}=e,t=await eo(),r=(0,p.wP)(m.db),n=(0,p.H9)(m.db,"expenses",a);return r.delete(n),r.update(t,{totalExpenses:(0,p.GV)(-s),expenseCount:(0,p.GV)(-1)}),await r.commit(),{id:a,amount:s}},onSuccess:s=>{let{id:t}=s;e.setQueryData([U],e=>e?{...e,pages:e.pages.map(e=>({...e,expenses:e.expenses.filter(e=>e.id!==t)}))}:e),e.invalidateQueries({queryKey:[U]}),e.invalidateQueries({queryKey:[W]}),e.invalidateQueries({queryKey:[U,"recent"]}),a({title:"Expense Deleted",description:"Successfully removed the expense record.",variant:"destructive"})},onError:e=>{a({title:"Error Deleting Expense",description:e.message||"Could not delete the expense.",variant:"destructive"}),console.error("Error deleting expense:",e)}}),ex=(0,d.mN)({resolver:(0,n.u)(es),defaultValues:{amount:void 0,category:"",vendor:"",notes:"",date:new Date}});return el?(0,t.jsxs)("div",{className:"text-destructive p-4",children:["Error loading data: ",el.message]}):(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)(f.Zp,{children:[(0,t.jsxs)(f.aR,{children:[(0,t.jsx)(f.ZB,{children:"Add New Expense"}),(0,t.jsx)(f.BT,{children:"Record a new expense transaction."})]}),(0,t.jsx)(G.lV,{...ex,children:(0,t.jsxs)("form",{onSubmit:ex.handleSubmit(function(e){ec.mutate(e)}),children:[(0,t.jsxs)(f.Wu,{className:"space-y-4",children:[(0,t.jsx)(G.zB,{control:ex.control,name:"date",render:e=>{let{field:a}=e;return(0,t.jsxs)(G.eI,{className:"flex flex-col",children:[(0,t.jsx)(G.lR,{children:"Date"}),(0,t.jsxs)(V,{children:[(0,t.jsx)(k,{asChild:!0,children:(0,t.jsx)(G.MJ,{children:(0,t.jsxs)(h.$,{variant:"outline",className:(0,w.cn)("w-full justify-start text-left font-normal",!a.value&&"text-muted-foreground"),disabled:ec.isPending,children:[(0,t.jsx)(I.A,{className:"mr-2 h-4 w-4"}),a.value?(0,l.GP)(et(a.value),"PPP"):(0,t.jsx)("span",{children:"Pick a date"})]})})}),(0,t.jsx)(B,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(L,{mode:"single",selected:a.value?et(a.value):void 0,onSelect:e=>a.onChange(e||new Date),disabled:e=>e>new Date||e<new Date("1900-01-01"),initialFocus:!0})})]}),(0,t.jsx)(G.C5,{})]})}}),(0,t.jsx)(G.zB,{control:ex.control,name:"amount",render:e=>{var a;let{field:s}=e;return(0,t.jsxs)(G.eI,{children:[(0,t.jsx)(G.lR,{children:"Amount"}),(0,t.jsx)(G.MJ,{children:(0,t.jsx)(g.p,{type:"number",placeholder:"0.00",...s,value:null!==(a=s.value)&&void 0!==a?a:"",step:"0.01",disabled:ec.isPending})}),(0,t.jsx)(G.C5,{})]})}}),(0,t.jsx)(G.zB,{control:ex.control,name:"category",render:e=>{let{field:a}=e;return(0,t.jsxs)(G.eI,{children:[(0,t.jsx)(G.lR,{children:"Category"}),(0,t.jsxs)(N,{onValueChange:a.onChange,value:a.value||"",disabled:R||0===D.length||ec.isPending,children:[(0,t.jsx)(G.MJ,{children:(0,t.jsx)(P,{children:(0,t.jsx)(A,{placeholder:R?"Loading categories...":0===D.length?"No categories available":"Select a category"})})}),(0,t.jsxs)(E,{children:[R&&(0,t.jsx)(z,{value:"loading",disabled:!0,children:"Loading..."}),!R&&0===D.length&&(0,t.jsx)(z,{value:"-",disabled:!0,children:"No categories available"}),D.map(e=>(0,t.jsx)(z,{value:e.name,children:e.name},e.id))]})]}),(0,t.jsx)(G.C5,{})]})}}),(0,t.jsx)(G.zB,{control:ex.control,name:"vendor",render:e=>{let{field:a}=e;return(0,t.jsxs)(G.eI,{children:[(0,t.jsx)(G.lR,{children:"Vendor (Optional)"}),(0,t.jsxs)(N,{onValueChange:a.onChange,value:a.value||"",disabled:en||ec.isPending,children:[(0,t.jsx)(G.MJ,{children:(0,t.jsx)(P,{children:(0,t.jsx)(A,{placeholder:en?"Loading vendors...":"Select a vendor or leave blank"})})}),(0,t.jsxs)(E,{children:[en&&(0,t.jsx)(z,{value:"loading",disabled:!0,children:"Loading..."}),(0,t.jsx)(z,{value:"__none__",children:"None"}),er.map(e=>(0,t.jsx)(z,{value:e.name,children:e.name},e.id)),!en&&0===er.length&&(0,t.jsx)(z,{value:"-",disabled:!0,children:"No vendors available"})]})]}),(0,t.jsx)(G.C5,{})]})}}),(0,t.jsx)(G.zB,{control:ex.control,name:"notes",render:e=>{var a;let{field:s}=e;return(0,t.jsxs)(G.eI,{children:[(0,t.jsx)(G.lR,{children:"Notes (Optional)"}),(0,t.jsx)(G.MJ,{children:(0,t.jsx)(J,{placeholder:"Add any relevant notes...",...s,value:null!==(a=s.value)&&void 0!==a?a:"",disabled:ec.isPending})}),(0,t.jsx)(G.C5,{})]})}})]}),(0,t.jsx)(f.wL,{children:(0,t.jsxs)(h.$,{type:"submit",className:"w-full",disabled:R||en||ec.isPending,children:[ec.isPending?(0,t.jsx)(K.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(T.A,{className:"mr-2 h-4 w-4"}),"Add Expense"]})})]})})]})}),(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsxs)(f.Zp,{children:[(0,t.jsxs)(f.aR,{children:[(0,t.jsx)(f.ZB,{children:"Expense History"}),(0,t.jsx)(f.BT,{children:"View all recorded expenses."})]}),(0,t.jsxs)(f.Wu,{children:[(0,t.jsxs)("div",{className:"overflow-x-auto",children:[" ",ei?(0,t.jsx)("div",{className:"space-y-2",children:[...Array(15)].map((e,a)=>(0,t.jsx)(Z.E,{className:"h-10 w-full rounded"},a))}):(0,t.jsxs)(F.XI,{children:[(0,t.jsx)(F.A0,{children:(0,t.jsxs)(F.Hj,{children:[(0,t.jsx)(F.nd,{className:"whitespace-nowrap",children:"Date"}),(0,t.jsx)(F.nd,{children:"Category"}),(0,t.jsx)(F.nd,{children:"Vendor"}),(0,t.jsx)(F.nd,{children:"Notes"}),(0,t.jsx)(F.nd,{className:"text-right whitespace-nowrap",children:"Amount"}),(0,t.jsx)(F.nd,{children:"Actions"})]})}),(0,t.jsxs)(F.BF,{children:[0===q.length&&!ei&&(0,t.jsx)(F.Hj,{children:(0,t.jsx)(F.nA,{colSpan:6,className:"text-center text-muted-foreground py-4",children:"No expenses recorded yet."})}),q.map(e=>{var a,s,r,n;return(0,t.jsxs)(F.Hj,{children:[(0,t.jsx)(F.nA,{className:"whitespace-nowrap",children:(0,l.GP)(et(e.date),"yyyy-MM-dd")}),(0,t.jsx)(F.nA,{children:(0,t.jsx)(O.E,{variant:"secondary",children:e.category})}),(0,t.jsx)(F.nA,{className:"whitespace-nowrap",children:e.vendor||"-"}),(0,t.jsx)(F.nA,{className:"max-w-[150px] sm:max-w-[250px] whitespace-normal break-words",title:null!==(n=e.notes)&&void 0!==n?n:void 0,children:e.notes||"-"}),(0,t.jsxs)(F.nA,{className:"text-right whitespace-nowrap",children:["$",e.amount.toFixed(2)]}),(0,t.jsx)(F.nA,{children:(0,t.jsxs)(Q.Lt,{children:[(0,t.jsx)(Q.tv,{asChild:!0,children:(0,t.jsx)(h.$,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive","aria-label":"Delete expense",disabled:eu.isPending&&(null===(a=eu.variables)||void 0===a?void 0:a.id)===e.id,children:eu.isPending&&(null===(s=eu.variables)||void 0===s?void 0:s.id)===e.id?(0,t.jsx)(K.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(H.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(Q.EO,{children:[(0,t.jsxs)(Q.wd,{children:[(0,t.jsx)(Q.r7,{children:"Are you sure?"}),(0,t.jsx)(Q.$v,{children:"This action cannot be undone. This will permanently delete this expense record."})]}),(0,t.jsxs)(Q.ck,{children:[(0,t.jsx)(Q.Zr,{disabled:eu.isPending,children:"Cancel"}),(0,t.jsxs)(Q.Rx,{className:(0,h.r)({variant:"destructive"}),onClick:()=>{var a,s;return a=e.id,s=e.amount,void eu.mutate({id:a,amount:s})},disabled:eu.isPending,children:[eu.isPending&&(null===(r=eu.variables)||void 0===r?void 0:r.id)===e.id?(0,t.jsx)(K.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})]})})]},e.id)})]})]})]}),(0,t.jsxs)("div",{ref:s,className:"mt-4 flex justify-center",children:[y&&(0,t.jsxs)(h.$,{onClick:()=>j(),disabled:_,variant:"outline",size:"sm",children:[_?(0,t.jsx)(K.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Load More"]}),!y&&q.length>0&&!ei&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No more expenses"})]})]})]})})]})}},6126:(e,a,s)=>{"use strict";s.d(a,{E:()=>i});var t=s(5155);s(2115);var r=s(2085),n=s(9434);let d=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:a,variant:s,...r}=e;return(0,t.jsx)("div",{className:(0,n.cn)(d({variant:s}),a),...r})}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,879,817,808,13,217,810,532,441,684,358],()=>a(2639)),_N_E=e.O()}]);